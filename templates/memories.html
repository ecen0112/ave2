{% extends "base.html" %}
{% block title %}Memories - Our Journey{% endblock %}
{% block content %}
<div class="memories-container">
  <h1 class="page-title">
    <span class="title-icon">üì∏</span>
    <span class="title-text">Our Precious Memories</span>
    <span class="title-sparkle">‚ú®</span>
  </h1>

  <div class="content-grid">
    <!-- Enhanced Add Memory Card -->
    <article class="card-3d add-memory-card">
      <div class="card-inner">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">üíï</span>
            Add New Memory
          </h3>
        </div>

        {% if session.get('role') == 'erl' or session.get('role') == 'love' %}
          <form method="post" enctype="multipart/form-data" class="stack add-memory-form" novalidate>
            <div class="form-group">
              <label for="category" class="form-label">Category</label>
              <select name="category" id="category" class="form-select" required>
                <option value="" disabled selected>Select a category...</option>
                <option value="Romantic">üíï Romantic</option>
                <option value="Adventure">üåü Adventure</option>
                <option value="Family">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</option>
                <option value="Travel">‚úàÔ∏è Travel</option>
                <option value="Food">üçΩÔ∏è Food</option>
                <option value="Celebration">üéâ Celebration</option>
                <option value="Other">üìù Other</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="memory-text" class="form-label">Memory</label>
              <textarea 
                name="memory" 
                id="memory-text" 
                rows="4" 
                class="form-textarea"
                placeholder="Describe this beautiful moment..."
                required
                maxlength="500"
              ></textarea>
              <div class="char-counter">
                <span id="char-count">0</span>/500
              </div>
            </div>
            
            <div class="form-group">
              <label for="memory-photo" class="form-label">Photo (Optional)</label>
              <div class="file-input-wrapper">
                <input 
                  type="file" 
                  name="photo" 
                  id="memory-photo"
                  accept="image/*" 
                  onchange="previewMemoryPhoto(this)"
                  class="file-input"
                >
                <label for="memory-photo" class="file-input-label">
                  <span class="file-icon">üì∏</span>
                  <span class="file-text">Choose Photo</span>
                </label>
              </div>
              <div class="image-preview" id="image-preview" style="display: none;">
                <img id="memory-preview" alt="Memory preview">
                <button type="button" class="remove-image" onclick="removeImagePreview()">
                  <span>√ó</span>
                </button>
              </div>
            </div>
            
            <button class="btn add-btn primary-btn" type="submit">
              <span class="btn-icon">üíæ</span>
              <span class="btn-text">Save Memory</span>
              <div class="btn-loading">
                <span class="spinner"></span>
              </div>
            </button>
          </form>
        {% else %}
          <div class="access-message">
            <div class="message-icon">üîí</div>
            <p class="message-text">Only admins can add memories.</p>
            <p class="message-subtext">Sign in as BUNBUN to add new memories.</p>
          </div>
        {% endif %}
      </div>
    </article>

    <!-- Enhanced Memories List Card -->
    <article class="card-3d memories-list-card">
      <div class="card-inner">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">üìö</span>
            All Memories
            {% if memories %}
              <span class="memory-count">({{ memories|length }})</span>
            {% endif %}
          </h3>
        </div>
        
        <!-- Enhanced Search and Sort -->
        <div class="search-sort-container">
          <div class="search-wrapper">
            <input 
              type="text" 
              id="memory-search" 
              class="search-input" 
              placeholder="Search memories..."
              onkeyup="filterMemories()"
              autocomplete="off"
            >
            <span class="search-icon">üîç</span>
            <button class="clear-search" onclick="clearSearch()" style="display: none;">√ó</button>
          </div>
          
          <div class="sort-wrapper">
            <select id="memory-sort" class="sort-select" onchange="sortMemories()">
              <option value="" disabled selected>Sort by...</option>
              <option value="timestamp-desc">üìÖ Newest First</option>
              <option value="timestamp-asc">üìÖ Oldest First</option>
              <option value="category">üìÅ Category</option>
              <option value="length">üìù Text Length</option>
            </select>
            <span class="sort-icon">‚ö°</span>
          </div>
        </div>

        <!-- Filter Tags -->
        <div class="filter-tags" id="filter-tags">
          <button class="filter-tag active" data-filter="all">All</button>
          <button class="filter-tag" data-filter="Romantic">üíï Romantic</button>
          <button class="filter-tag" data-filter="Adventure">üåü Adventure</button>
          <button class="filter-tag" data-filter="Family">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</button>
          <button class="filter-tag" data-filter="Travel">‚úàÔ∏è Travel</button>
          <button class="filter-tag" data-filter="Food">üçΩÔ∏è Food</button>
          <button class="filter-tag" data-filter="Celebration">üéâ Celebration</button>
          <button class="filter-tag" data-filter="Other">üìù Other</button>
        </div>
        
        {% if memories %}
          <div class="memory-list" id="memory-list">
            {% for m in memories %}
              <div class="memory-card" 
                   data-category="{{ m.category|default('Other') }}" 
                   data-content="{{ m.text|lower }}" 
                   data-timestamp="{{ m.timestamp }}"
                   data-length="{{ m.text|length }}">
                
                <div class="memory-header">
                  <span class="memory-category">
                    {% if m.category == 'Romantic' %}üíï
                    {% elif m.category == 'Adventure' %}üåü
                    {% elif m.category == 'Family' %}üë®‚Äçüë©‚Äçüëß‚Äçüë¶
                    {% elif m.category == 'Travel' %}‚úàÔ∏è
                    {% elif m.category == 'Food' %}üçΩÔ∏è
                    {% elif m.category == 'Celebration' %}üéâ
                    {% else %}üìù
                    {% endif %}
                    {{ m.category|default('Other') }}
                  </span>
                  <span class="memory-timestamp">{{ m.timestamp|datetime }}</span>
                </div>
                
                <div class="memory-content">
                  <div class="memory-text-wrapper">
                    <p class="memory-text">{{ m.text }}</p>
                  </div>
                  
                  {% if m.photo %}
                    <div class="memory-photo-container">
                      <img 
                        src="{{ url_for('static', filename='memories/' + m.photo) }}" 
                        class="memory-photo" 
                        alt="Memory photo"
                        loading="lazy"
                        onclick="openPhotoModal(this)"
                      >
                      <div class="photo-overlay">
                        <span class="photo-zoom">üîç</span>
                      </div>
                    </div>
                  {% endif %}
                </div>
                
                <div class="memory-actions">
                  <button 
                    type="button" 
                    class="btn action-btn share-btn" 
                    data-text="{{ m.text }}" 
                    data-category="{{ m.category|default('Other') }}"
                    title="Share memory"
                  >
                    <span class="btn-icon">üì§</span>
                    <span class="btn-text">Share</span>
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn action-btn edit-btn" 
                    onclick="editMemory(this, '{{ loop.index0 }}')"
                    title="Edit memory"
                  >
                    <span class="btn-icon">‚úèÔ∏è</span>
                    <span class="btn-text">Edit</span>
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn action-btn delete-btn" 
                    onclick="openDeleteModal('{{ loop.index0 }}')"
                    title="Delete memory"
                  >
                    <span class="btn-icon">üóëÔ∏è</span>
                    <span class="btn-text">Delete</span>
                  </button>
                  
                  <form 
                    method="post" 
                    action="{{ url_for('edit_memory', idx=loop.index0) }}" 
                    class="edit-form" 
                    style="display:none;"
                  >
                    <input type="hidden" name="new_text" value="">
                  </form>
                  
                  <form 
                    method="post" 
                    action="{{ url_for('delete_memory', idx=loop.index0) }}" 
                    class="delete-form" 
                    id="delete-form-{{ loop.index0 }}"
                  ></form>
                </div>
              </div>
            {% endfor %}
          </div>
          
          <!-- Load More Button -->
          <div class="load-more-container" style="display: none;">
            <button class="btn load-more-btn" onclick="loadMoreMemories()">
              <span class="btn-icon">‚¨áÔ∏è</span>
              <span class="btn-text">Load More</span>
            </button>
          </div>
        {% else %}
          <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h3 class="empty-title">No Memories Yet</h3>
            <p class="empty-text">Start creating beautiful memories together!</p>
          </div>
        {% endif %}
      </div>
    </article>
  </div>
</div>

<!-- Enhanced Delete Confirmation Modal -->
<div id="delete-modal" class="modal" style="display: none;" role="dialog" aria-labelledby="modal-title">
  <div class="modal-backdrop" onclick="closeDeleteModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modal-title" class="modal-title">
        <span class="modal-icon">‚ö†Ô∏è</span>
        Confirm Deletion
      </h3>
      <button class="modal-close" onclick="closeDeleteModal()" aria-label="Close modal">√ó</button>
    </div>
    
    <div class="modal-body">
      <p class="modal-message">Are you sure you want to delete this memory?</p>
      <p class="modal-warning">This action cannot be undone.</p>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn secondary-btn" onclick="closeDeleteModal()">
        <span class="btn-icon">‚ùå</span>
        <span class="btn-text">Cancel</span>
      </button>
      <button type="submit" class="btn danger-btn confirm-delete-btn" form="">
        <span class="btn-icon">üóëÔ∏è</span>
        <span class="btn-text">Delete</span>
      </button>
    </div>
  </div>
</div>

<!-- Photo Modal -->
<div id="photo-modal" class="modal photo-modal" style="display: none;" role="dialog">
  <div class="modal-backdrop" onclick="closePhotoModal()"></div>
  <div class="photo-modal-content">
    <button class="photo-modal-close" onclick="closePhotoModal()" aria-label="Close photo">√ó</button>
    <img id="modal-photo" alt="Full size memory photo">
    <div class="photo-modal-controls">
      <button class="photo-control" onclick="downloadPhoto()" title="Download">üì•</button>
      <button class="photo-control" onclick="sharePhoto()" title="Share">üì§</button>
    </div>
  </div>
</div>

<style>
/* Container and Layout */
.memories-container {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 0;
}

.content-grid {
  display: grid;
  gap: clamp(16px, 3vw, 32px);
  padding: clamp(12px, 3vw, 24px);
  grid-template-columns: 1fr;
}

/* Desktop Layout */
@media (min-width: 1200px) {
  .content-grid {
    grid-template-columns: 400px 1fr;
    gap: 32px;
    padding: 32px;
  }
  
  .add-memory-card {
    grid-row: 1 / 3;
  }
}

@media (min-width: 992px) and (max-width: 1199px) {
  .content-grid {
    grid-template-columns: 350px 1fr;
    gap: 24px;
    padding: 24px;
  }
  
  .add-memory-card {
    grid-row: 1 / 3;
  }
}

/* Tablet Layout */
@media (min-width: 768px) and (max-width: 991px) {
  .content-grid {
    grid-template-columns: 1fr;
    gap: 24px;
    padding: 20px;
  }
}

/* Mobile Layout */
@media (max-width: 767px) {
  .content-grid {
    grid-template-columns: 1fr;
    gap: 16px;
    padding: 16px;
  }
}

/* Enhanced Page Title */
.page-title {
  font-size: clamp(1.8rem, 4vw, 2rem);
  font-weight: 800;
  background: linear-gradient(135deg, var(--accent), var(--accent-2), var(--accent-3));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-align: center;
  margin: clamp(16px, 4vw, 32px) 0 clamp(24px, 5vw, 48px);
  animation: titleGlow 3s ease-in-out infinite alternate;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(8px, 2vw, 16px);
  flex-wrap: wrap;
}

.title-icon, .title-sparkle {
  font-size: clamp(1.5rem, 4vw, 2.5rem);
  animation: iconFloat 3s ease-in-out infinite;
}

.title-sparkle {
  animation-delay: 1s;
}

@keyframes titleGlow {
  0% { text-shadow: 0 0 20px rgba(255, 90, 122, 0.3); }
  100% { text-shadow: 0 0 30px rgba(255, 90, 122, 0.6); }
}

@keyframes iconFloat {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-8px) rotate(5deg); }
}

/* Enhanced Cards */
.card-3d {
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(20px) saturate(150%);
  border-radius: clamp(16px, 3vw, 24px);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.12),
    0 2px 8px rgba(0, 0, 0, 0.08),
    inset 0 1px 2px rgba(255, 255, 255, 0.1);
  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
  border: 1px solid rgba(255, 255, 255, 0.1);
  overflow: hidden;
  position: relative;
}

.card-3d::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 50% 0%, rgba(255, 90, 122, 0.05), transparent 60%);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.card-3d:hover::before {
  opacity: 1;
}

.card-3d:hover {
  transform: translateY(-4px) scale(1.01);
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.15),
    0 8px 32px rgba(0, 0, 0, 0.1),
    inset 0 1px 4px rgba(255, 255, 255, 0.15);
}

.card-inner {
  padding: clamp(16px, 4vw, 32px);
  position: relative;
  z-index: 1;
}

.card-header {
  margin-bottom: clamp(16px, 3vw, 24px);
  text-align: center;
}

.card-title {
  font-size: clamp(1.2rem, 3vw, 1.6rem);
  font-weight: 700;
  color: white;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
}

.card-icon {
  font-size: clamp(1.2rem, 3vw, 1.5rem);
}

.memory-count {
  font-size: clamp(0.9rem, 2vw, 1.1rem);
  color: var(--accent-2);
  font-weight: 500;
}

/* Enhanced Forms */
.stack {
  display: flex;
  flex-direction: column;
  gap: clamp(16px, 3vw, 24px);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-label {
  font-size: clamp(0.9rem, 2vw, 1rem);
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 4px;
}

.form-select, .form-textarea, .search-input, .sort-select {
  padding: clamp(12px, 3vw, 16px);
  border-radius: clamp(10px, 2vw, 14px);
  border: 2px solid rgba(255, 255, 255, 0.15);
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  color: white;
  font-size: clamp(0.9rem, 2vw, 1rem);
  transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
  width: 100%;
}

.form-select:focus, .form-textarea:focus, .search-input:focus, .sort-select:focus {
  outline: none;
  border-color: var(--accent);
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 90, 122, 0.2);
}

.form-textarea {
  resize: vertical;
  min-height: clamp(80px, 15vw, 120px);
  font-family: inherit;
}

.char-counter {
  text-align: right;
  font-size: clamp(0.8rem, 2vw, 0.9rem);
  color: rgba(255, 255, 255, 0.6);
  margin-top: 4px;
}

/* File Input Enhancement */
.file-input-wrapper {
  position: relative;
}

.file-input {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.file-input-label {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: clamp(12px, 3vw, 16px);
  border: 2px dashed rgba(255, 255, 255, 0.3);
  border-radius: clamp(10px, 2vw, 14px);
  background: rgba(255, 255, 255, 0.05);
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: clamp(0.9rem, 2vw, 1rem);
  color: rgba(255, 255, 255, 0.8);
}

.file-input-label:hover {
  border-color: var(--accent);
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

.file-icon {
  font-size: clamp(1.2rem, 3vw, 1.5rem);
}

.image-preview {
  margin-top: 16px;
  position: relative;
  border-radius: clamp(10px, 2vw, 14px);
  overflow: hidden;
  background: rgba(0, 0, 0, 0.3);
}

.image-preview img {
  width: 100%;
  max-height: clamp(200px, 30vw, 300px);
  object-fit: cover;
  border-radius: inherit;
}

.remove-image {
  position: absolute;
  top: 8px;
  right: 8px;
  width: clamp(28px, 5vw, 32px);
  height: clamp(28px, 5vw, 32px);
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  cursor: pointer;
  font-size: clamp(16px, 3vw, 20px);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.remove-image:hover {
  background: rgba(255, 90, 122, 0.8);
  transform: scale(1.1);
}

/* Enhanced Buttons */
.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(6px, 2vw, 8px);
  padding: clamp(10px, 3vw, 16px) clamp(16px, 4vw, 24px);
  border: none;
  border-radius: clamp(10px, 2vw, 14px);
  font-size: clamp(0.9rem, 2vw, 1rem);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
  position: relative;
  overflow: hidden;
  text-decoration: none;
  min-height: clamp(40px, 8vw, 48px);
  backdrop-filter: blur(10px);
}

.primary-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: white;
  box-shadow: 0 4px 20px rgba(255, 90, 122, 0.3);
}

.primary-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(255, 90, 122, 0.4);
}

.secondary-btn {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.secondary-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-1px);
}

.danger-btn {
  background: linear-gradient(135deg, #ff4757, #ff6b7d);
  color: white;
  box-shadow: 0 4px 20px rgba(255, 71, 87, 0.3);
}

.danger-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(255, 71, 87, 0.4);
}

.action-btn {
  padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 16px);
  font-size: clamp(0.8rem, 2vw, 0.9rem);
  min-height: auto;
}

.btn-icon {
  font-size: clamp(0.9rem, 2vw, 1.1rem);
  flex-shrink: 0;
}

.btn-loading {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: inherit;
  border-radius: inherit;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Access Message */
.access-message {
  text-align: center;
  padding: clamp(24px, 5vw, 40px) clamp(16px, 4vw, 24px);
}

.message-icon {
  font-size: clamp(2rem, 6vw, 3rem);
  margin-bottom: 16px;
}

.message-text {
  font-size: clamp(1rem, 3vw, 1.2rem);
  font-weight: 600;
  color: white;
  margin: 0 0 8px;
}

.message-subtext {
  font-size: clamp(0.9rem, 2vw, 1rem);
  color: rgba(255, 255, 255, 0.7);
  margin: 0;
}

/* Search and Sort Container */
.search-sort-container {
  display: grid;
  gap: clamp(12px, 3vw, 16px);
  margin-bottom: clamp(16px, 3vw, 24px);
  grid-template-columns: 1fr;
}

@media (min-width: 600px) {
  .search-sort-container {
    grid-template-columns: 1fr auto;
  }
}

.search-wrapper, .sort-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.search-icon, .sort-icon {
  position: absolute;
  left: clamp(12px, 3vw, 16px);
  font-size: clamp(0.9rem, 2vw, 1rem);
  color: rgba(255, 255, 255, 0.6);
  z-index: 2;
  pointer-events: none;
}

.search-input, .sort-select {
  padding-left: clamp(40px, 8vw, 48px);
}

.clear-search {
  position: absolute;
  right: clamp(12px, 3vw, 16px);
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  font-size: clamp(16px, 3vw, 20px);
  cursor: pointer;
  width: clamp(24px, 5vw, 28px);
  height: clamp(24px, 5vw, 28px);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 2;
}

.clear-search:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

/* Filter Tags */
.filter-tags {
  display: flex;
  gap: clamp(8px, 2vw, 12px);
  margin-bottom: clamp(16px, 3vw, 24px);
  flex-wrap: wrap;
  justify-content: center;
}

.filter-tag {
  padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 16px);
  border-radius: clamp(16px, 3vw, 20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: rgba(255, 255, 255, 0.05);
  color: rgba(255, 255, 255, 0.8);
  font-size: clamp(0.8rem, 2vw, 0.9rem);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  white-space: nowrap;
}

.filter-tag:hover, .filter-tag.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
  transform: translateY(-1px);
}

/* Memory List */
.memory-list {
  display: flex;
  flex-direction: column;
  gap: clamp(16px, 3vw, 24px);
}

.memory-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  border-radius: clamp(12px, 3vw, 18px);
  padding: clamp(16px, 4vw, 24px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
  position: relative;
  overflow: hidden;
}

.memory-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(45deg, transparent, rgba(255, 90, 122, 0.05), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.memory-card:hover::before {
  opacity: 1;
}

.memory-card:hover {
  background: rgba(255, 255, 255, 0.12);
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(255, 90, 122, 0.15);
}

.memory-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: clamp(12px, 3vw, 16px);
  flex-wrap: wrap;
  gap: 8px;
  position: relative;
  z-index: 2;
}

.memory-category {
  font-size: clamp(0.8rem, 2vw, 0.9rem);
  font-weight: 700;
  color: var(--accent);
  background: rgba(255, 90, 122, 0.1);
  padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 12px);
  border-radius: clamp(12px, 3vw, 16px);
  border: 1px solid rgba(255, 90, 122, 0.2);
  white-space: nowrap;
}

.memory-timestamp {
  font-size: clamp(0.7rem, 2vw, 0.8rem);
  color: rgba(255, 255, 255, 0.6);
  font-weight: 500;
  white-space: nowrap;
}

.memory-content {
  position: relative;
  z-index: 2;
  margin-bottom: clamp(16px, 3vw, 20px);
}

.memory-text-wrapper {
  margin-bottom: clamp(12px, 3vw, 16px);
}

.memory-text {
  font-size: clamp(0.9rem, 2vw, 1rem);
  line-height: 1.6;
  color: rgba(255, 255, 255, 0.95);
  margin: 0;
  word-wrap: break-word;
  position: relative;
}

.memory-photo-container {
  position: relative;
  border-radius: clamp(10px, 2vw, 14px);
  overflow: hidden;
  background: rgba(0, 0, 0, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.memory-photo-container:hover {
  transform: scale(1.02);
}

.memory-photo {
  width: 100%;
  height: auto;
  max-height: clamp(200px, 40vw, 400px);
  object-fit: cover;
  border-radius: inherit;
  transition: all 0.3s ease;
  display: block;
}

.memory-photo-container:hover .memory-photo {
  filter: brightness(1.1);
}

.photo-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.memory-photo-container:hover .photo-overlay {
  opacity: 1;
}

.photo-zoom {
  font-size: clamp(1.5rem, 4vw, 2rem);
  color: white;
  background: rgba(0, 0, 0, 0.5);
  width: clamp(40px, 8vw, 50px);
  height: clamp(40px, 8vw, 50px);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.memory-actions {
  display: flex;
  gap: clamp(8px, 2vw, 12px);
  justify-content: flex-end;
  flex-wrap: wrap;
  position: relative;
  z-index: 2;
}

@media (max-width: 480px) {
  .memory-actions {
    justify-content: center;
  }
  
  .action-btn {
    flex: 1;
    min-width: 0;
  }
  
  .action-btn .btn-text {
    display: none;
  }
  
  .action-btn .btn-icon {
    margin: 0;
  }
}

.share-btn {
  background: linear-gradient(135deg, #10b981, #34d399);
}

.share-btn:hover {
  background: linear-gradient(135deg, #059669, #10b981);
}

.edit-btn {
  background: linear-gradient(135deg, #3b82f6, #60a5fa);
}

.edit-btn:hover {
  background: linear-gradient(135deg, #2563eb, #3b82f6);
}

.delete-btn {
  background: linear-gradient(135deg, #ef4444, #f87171);
}

.delete-btn:hover {
  background: linear-gradient(135deg, #dc2626, #ef4444);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: clamp(40px, 8vw, 80px) clamp(20px, 4vw, 40px);
}

.empty-icon {
  font-size: clamp(3rem, 8vw, 5rem);
  margin-bottom: clamp(16px, 3vw, 24px);
  opacity: 0.7;
}

.empty-title {
  font-size: clamp(1.2rem, 4vw, 1.8rem);
  font-weight: 700;
  color: white;
  margin: 0 0 clamp(8px, 2vw, 12px);
}

.empty-text {
  font-size: clamp(0.9rem, 3vw, 1.1rem);
  color: rgba(255, 255, 255, 0.7);
  margin: 0;
}

/* Load More Button */
.load-more-container {
  text-align: center;
  margin-top: clamp(24px, 5vw, 40px);
}

.load-more-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.2);
  color: white;
}

.load-more-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: var(--accent);
}

/* Enhanced Modals */
.modal {
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(16px, 4vw, 24px);
  animation: modalFadeIn 0.3s ease-out;
}

.modal-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
  cursor: pointer;
}

.modal-content {
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(25px) saturate(150%);
  border-radius: clamp(16px, 4vw, 24px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 20px 80px rgba(0, 0, 0, 0.3);
  width: 100%;
  max-width: clamp(320px, 90vw, 480px);
  position: relative;
  z-index: 2;
  animation: modalSlideIn 0.3s cubic-bezier(0.23, 1, 0.32, 1);
  overflow: hidden;
}

.modal-header {
  padding: clamp(20px, 5vw, 32px) clamp(20px, 5vw, 32px) 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: clamp(1.2rem, 4vw, 1.6rem);
  font-weight: 700;
  color: white;
  margin: 0;
  display: flex;
  align-items: center;
  gap: clamp(8px, 2vw, 12px);
}

.modal-icon {
  font-size: clamp(1.3rem, 4vw, 1.7rem);
}

.modal-close {
  width: clamp(32px, 6vw, 40px);
  height: clamp(32px, 6vw, 40px);
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.8);
  font-size: clamp(18px, 4vw, 24px);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.modal-close:hover {
  background: rgba(255, 90, 122, 0.8);
  color: white;
  transform: scale(1.1);
}

.modal-body {
  padding: clamp(16px, 4vw, 24px) clamp(20px, 5vw, 32px);
}

.modal-message {
  font-size: clamp(1rem, 3vw, 1.1rem);
  color: white;
  margin: 0 0 clamp(8px, 2vw, 12px);
  line-height: 1.5;
}

.modal-warning {
  font-size: clamp(0.9rem, 2vw, 1rem);
  color: rgba(255, 255, 255, 0.7);
  font-style: italic;
  margin: 0;
}

.modal-footer {
  padding: 0 clamp(20px, 5vw, 32px) clamp(20px, 5vw, 32px);
  display: flex;
  gap: clamp(12px, 3vw, 16px);
  justify-content: flex-end;
}

@media (max-width: 480px) {
  .modal-footer {
    flex-direction: column-reverse;
  }
  
  .modal-footer .btn {
    width: 100%;
  }
}

/* Photo Modal */
.photo-modal {
  background: rgba(0, 0, 0, 0.9);
}

.photo-modal-content {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 2;
}

.photo-modal-close {
  position: absolute;
  top: clamp(16px, 4vw, 24px);
  right: clamp(16px, 4vw, 24px);
  width: clamp(40px, 8vw, 50px);
  height: clamp(40px, 8vw, 50px);
  border-radius: 50%;
  border: none;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: clamp(20px, 4vw, 28px);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 3;
  backdrop-filter: blur(10px);
}

.photo-modal-close:hover {
  background: rgba(255, 90, 122, 0.8);
  transform: scale(1.1);
}

#modal-photo {
  max-width: 100%;
  max-height: 80vh;
  object-fit: contain;
  border-radius: clamp(8px, 2vw, 12px);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.photo-modal-controls {
  display: flex;
  gap: clamp(12px, 3vw, 16px);
  margin-top: clamp(16px, 4vw, 24px);
}

.photo-control {
  width: clamp(40px, 8vw, 50px);
  height: clamp(40px, 8vw, 50px);
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-size: clamp(16px, 3vw, 20px);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.photo-control:hover {
  background: rgba(255, 90, 122, 0.8);
  transform: scale(1.1);
}

/* Animations */
@keyframes modalFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Loading States */
.btn.loading .btn-text {
  opacity: 0;
}

.btn.loading .btn-loading {
  display: flex;
}

/* Focus States for Accessibility */
.btn:focus,
.form-select:focus,
.form-textarea:focus,
.search-input:focus,
.sort-select:focus,
.filter-tag:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Print Styles */
@media print {
  .memory-actions,
  .search-sort-container,
  .filter-tags,
  .modal {
    display: none !important;
  }
  
  .memory-card {
    break-inside: avoid;
    margin-bottom: 1rem;
    background: white !important;
    color: black !important;
  }
  
  .page-title {
    color: black !important;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
  .card-3d,
  .memory-card {
    border: 2px solid white;
  }
  
  .btn {
    border: 2px solid currentColor;
  }
}

/* Dark Mode Adjustments */
@media (prefers-color-scheme: dark) {
  .form-select,
  .form-textarea,
  .search-input,
  .sort-select {
    color: white;
  }
  
  .form-select option {
    background: #1a1a1a;
    color: white;
  }
}

/* Landscape Mobile Optimization */
@media (max-height: 500px) and (orientation: landscape) {
  .page-title {
    font-size: 1.5rem;
    margin: 16px 0 24px;
  }
  
  .modal-content {
    max-height: 90vh;
    overflow-y: auto;
  }
  
  .card-inner {
    padding: 16px;
  }
}

/* Very Small Screens */
@media (max-width: 320px) {
  .content-grid {
    padding: 8px;
    gap: 12px;
  }
  
  .card-inner {
    padding: 12px;
  }
  
  .memory-actions {
    flex-direction: column;
  }
  
  .action-btn {
    width: 100%;
  }
}

/* Large Desktop Optimization */
@media (min-width: 1400px) {
  .memories-container {
    max-width: 1600px;
  }
  
  .content-grid {
    grid-template-columns: 450px 1fr;
    gap: 40px;
    padding: 40px;
  }
  
  .memory-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 24px;
  }
}

/* Ultra-wide Screen Support */
@media (min-width: 1920px) {
  .memory-list {
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 32px;
  }
}
</style>

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  initializeMemoriesPage();
});

function initializeMemoriesPage() {
  // Character counter for textarea
  const textarea = document.getElementById('memory-text');
  const charCount = document.getElementById('char-count');
  
  if (textarea && charCount) {
    textarea.addEventListener('input', () => {
      const count = textarea.value.length;
      charCount.textContent = count;
      
      // Color coding for character limit
      if (count > 450) {
        charCount.style.color = '#ff4757';
      } else if (count > 400) {
        charCount.style.color = '#ffa502';
      } else {
        charCount.style.color = 'rgba(255, 255, 255, 0.6)';
      }
    });
  }
  
  // Initialize filter tags
  const filterTags = document.querySelectorAll('.filter-tag');
  filterTags.forEach(tag => {
    tag.addEventListener('click', () => {
      // Remove active class from all tags
      filterTags.forEach(t => t.classList.remove('active'));
      // Add active class to clicked tag
      tag.classList.add('active');
      
      // Filter memories
      const filter = tag.getAttribute('data-filter');
      filterMemoriesByCategory(filter);
    });
  });
  
  // Initialize share buttons
  const shareButtons = document.querySelectorAll('.share-btn');
  shareButtons.forEach(button => {
    button.addEventListener('click', () => {
      const text = button.getAttribute('data-text');
      const category = button.getAttribute('data-category');
      shareMemory(text, category);
    });
  });
  
  // Initialize search input
  const searchInput = document.getElementById('memory-search');
  const clearSearch = document.querySelector('.clear-search');
  
  if (searchInput && clearSearch) {
    searchInput.addEventListener('input', () => {
      if (searchInput.value.length > 0) {
        clearSearch.style.display = 'flex';
      } else {
        clearSearch.style.display = 'none';
      }
      filterMemories();
    });
  }
  
  // Initialize lazy loading for images
  if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.dataset.src || img.src;
          img.classList.remove('lazy');
          observer.unobserve(img);
        }
      });
    });
    
    document.querySelectorAll('img[loading="lazy"]').forEach(img => {
      imageObserver.observe(img);
    });
  }
}

function filterMemories() {
  const input = document.getElementById("memory-search").value.toLowerCase();
  const cards = document.getElementsByClassName("memory-card");
  let visibleCount = 0;
  
  for (let card of cards) {
    const content = card.dataset.content;
    const category = card.dataset.category.toLowerCase();
    
    if (content.includes(input) || category.includes(input)) {
      card.style.display = "";
      visibleCount++;
    } else {
      card.style.display = "none";
    }
  }
  
  // Update memory count if exists
  const memoryCount = document.querySelector('.memory-count');
  if (memoryCount) {
    memoryCount.textContent = `(${visibleCount})`;
  }
}

function filterMemoriesByCategory(category) {
  const cards = document.getElementsByClassName("memory-card");
  let visibleCount = 0;
  
  for (let card of cards) {
    const cardCategory = card.dataset.category;
    
    if (category === 'all' || cardCategory === category) {
      card.style.display = "";
      visibleCount++;
    } else {
      card.style.display = "none";
    }
  }
  
  // Update memory count
  const memoryCount = document.querySelector('.memory-count');
  if (memoryCount) {
    memoryCount.textContent = `(${visibleCount})`;
  }
}

function clearSearch() {
  const searchInput = document.getElementById("memory-search");
  const clearButton = document.querySelector('.clear-search');
  
  if (searchInput) {
    searchInput.value = '';
    clearButton.style.display = 'none';
    filterMemories();
  }
}

function sortMemories() {
  const select = document.getElementById("memory-sort");
  const value = select.value;
  const list = document.getElementById("memory-list");
  
  if (!list) return;
  
  const cards = Array.from(list.getElementsByClassName("memory-card"));
  
  cards.sort((a, b) => {
    switch (value) {
      case "timestamp-desc":
        return b.dataset.timestamp.localeCompare(a.dataset.timestamp);
      case "timestamp-asc":
        return a.dataset.timestamp.localeCompare(b.dataset.timestamp);
      case "category":
        return a.dataset.category.localeCompare(b.dataset.category);
      case "length":
        return parseInt(b.dataset.length) - parseInt(a.dataset.length);
      default:
        return 0;
    }
  });
  
  // Animate sorting
  list.style.opacity = '0.5';
  setTimeout(() => {
    list.innerHTML = "";
    cards.forEach(card => list.appendChild(card));
    list.style.opacity = '1';
  }, 150);
}

function editMemory(button, index) {
  const card = button.closest(".memory-card");
  const textElement = card.querySelector(".memory-text");
  const currentText = textElement.textContent.trim();
  const form = card.querySelector(".edit-form");
  const input = form.querySelector("input[name='new_text']");

  if (button.querySelector('.btn-text').textContent === "Edit") {
    // Create editing interface
    const editContainer = document.createElement("div");
    editContainer.className = "edit-container";
    editContainer.innerHTML = `
      <textarea class="edit-textarea" rows="3" maxlength="500">${currentText}</textarea>
      <div class="edit-actions">
        <button type="button" class="btn secondary-btn cancel-edit">
          <span class="btn-icon">‚ùå</span>
          <span class="btn-text">Cancel</span>
        </button>
        <button type="button" class="btn primary-btn save-edit">
          <span class="btn-icon">üíæ</span>
          <span class="btn-text">Save</span>
        </button>
      </div>
    `;
    
    textElement.style.display = 'none';
    textElement.parentNode.insertBefore(editContainer, textElement.nextSibling);
    
    // Update button
    button.innerHTML = `
      <span class="btn-icon">üíæ</span>
      <span class="btn-text">Save</span>
    `;
    
    // Add event listeners
    const cancelBtn = editContainer.querySelector('.cancel-edit');
    const saveBtn = editContainer.querySelector('.save-edit');
    const textarea = editContainer.querySelector('.edit-textarea');
    
    cancelBtn.addEventListener('click', () => {
      editContainer.remove();
      textElement.style.display = '';
      button.innerHTML = `
        <span class="btn-icon">‚úèÔ∏è</span>
        <span class="btn-text">Edit</span>
      `;
    });
    
    saveBtn.addEventListener('click', () => {
      const newText = textarea.value.trim();
      if (newText && newText !== currentText) {
        input.value = newText;
        
        // Show loading state
        button.classList.add('loading');
        form.submit();
      } else if (!newText) {
        showNotification('Memory text cannot be empty!', 'error');
      } else {
        // No changes, just cancel
        cancelBtn.click();
      }
    });
    
    // Auto-focus textarea
    textarea.focus();
    textarea.select();
    
  }
}

function shareMemory(text, category) {
  if (!text || !category) {
    showNotification('Cannot share: Memory data is missing.', 'error');
    return;
  }
  
  const shareText = `üíï Memory: [${category}] ${text}`;
  
  // Try native sharing first
  if (navigator.share) {
    navigator.share({
      title: 'Our Journey - Memory',
      text: shareText,
    }).then(() => {
      showNotification('Memory shared successfully! üíï', 'success');
    }).catch(() => {
      copyToClipboard(shareText);
    });
  } else {
    copyToClipboard(shareText);
  }
}

function copyToClipboard(text) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => {
      showNotification('Memory copied to clipboard! üìã', 'success');
    }).catch(() => {
      fallbackCopyTextToClipboard(text);
    });
  } else {
    fallbackCopyTextToClipboard(text);
  }
}

function fallbackCopyTextToClipboard(text) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.style.position = "fixed";
  textArea.style.left = "-999999px";
  textArea.style.top = "-999999px";
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    showNotification('Memory copied to clipboard! üìã', 'success');
  } catch (err) {
    showNotification('Could not copy text: ' + text, 'error');
  }
  
  document.body.removeChild(textArea);
}

function previewMemoryPhoto(input) {
  const file = input.files[0];
  const preview = document.getElementById("memory-preview");
  const previewContainer = document.getElementById("image-preview");
  const label = input.nextElementSibling;
  
  if (file) {
    // Validate file size (5MB limit)
    if (file.size > 5 * 1024 * 1024) {
      showNotification('File size must be less than 5MB', 'error');
      input.value = '';
      return;
    }
    
    // Validate file type
    if (!file.type.startsWith('image/')) {
      showNotification('Please select an image file', 'error');
      input.value = '';
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      previewContainer.style.display = "block";
      label.innerHTML = `
        <span class="file-icon">‚úÖ</span>
        <span class="file-text">Photo Selected</span>
      `;
    };
    reader.readAsDataURL(file);
  } else {
    removeImagePreview();
  }
}

function removeImagePreview() {
  const preview = document.getElementById("memory-preview");
  const previewContainer = document.getElementById("image-preview");
  const input = document.getElementById("memory-photo");
  const label = input.nextElementSibling;
  
  preview.src = '';
  previewContainer.style.display = "none";
  input.value = '';
  label.innerHTML = `
    <span class="file-icon">üì∏</span>
    <span class="file-text">Choose Photo</span>
  `;
}

function openDeleteModal(index) {
  const modal = document.getElementById("delete-modal");
  const confirmBtn = modal.querySelector(".confirm-delete-btn");
  
  if (modal && confirmBtn) {
    modal.style.display = "flex";
    confirmBtn.setAttribute("form", `delete-form-${index}`);
    
    // Focus management for accessibility
    const closeBtn = modal.querySelector(".modal-close");
    if (closeBtn) {
      closeBtn.focus();
    }
  }
}

function closeDeleteModal() {
  const modal = document.getElementById("delete-modal");
  if (modal) {
    modal.style.display = "none";
  }
}

function openPhotoModal(img) {
  const modal = document.getElementById("photo-modal");
  const modalPhoto = document.getElementById("modal-photo");
  
  if (modal && modalPhoto) {
    modalPhoto.src = img.src;
    modalPhoto.alt = img.alt;
    modal.style.display = "flex";
    
    // Store current photo for download/share
    modal.dataset.currentPhoto = img.src;
  }
}

function closePhotoModal() {
  const modal = document.getElementById("photo-modal");
  if (modal) {
    modal.style.display = "none";
  }
}

function downloadPhoto() {
  const modal = document.getElementById("photo-modal");
  const photoSrc = modal.dataset.currentPhoto;
  
  if (photoSrc) {
    const link = document.createElement('a');
    link.href = photoSrc;
    link.download = `memory-photo-${Date.now()}.jpg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('Photo download started! üì•', 'success');
  }
}

function sharePhoto() {
  const modal = document.getElementById("photo-modal");
  const photoSrc = modal.dataset.currentPhoto;
  
  if (photoSrc && navigator.share) {
    fetch(photoSrc)
      .then(response => response.blob())
      .then(blob => {
        const file = new File([blob], 'memory-photo.jpg', { type: blob.type });
        return navigator.share({
          title: 'Our Journey - Memory Photo',
          files: [file]
        });
      })
      .then(() => {
        showNotification('Photo shared successfully! üì§', 'success');
      })
      .catch(() => {
        // Fallback to copying image URL
        copyToClipboard(photoSrc);
      });
  } else {
    copyToClipboard(photoSrc);
  }
}

function loadMoreMemories() {
  // This would typically load more memories from the server
  // For now, we'll just show a message
  showNotification('All memories loaded! üìö', 'info');
  
  const loadMoreBtn = document.querySelector('.load-more-container');
  if (loadMoreBtn) {
    loadMoreBtn.style.display = 'none';
  }
}

function showNotification(message, type = 'info') {
  // Check if we're in the base template context (with notification system)
  if (typeof window.showNotification === 'function') {
    window.showNotification(message, type);
    return;
  }
  
  // Fallback notification system for standalone page
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.innerHTML = `
    <span class="notification-icon">${getNotificationIcon(type)}</span>
    <span class="notification-message">${message}</span>
    <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
  `;
  
  // Create container if it doesn't exist
  let container = document.getElementById('temp-notification-container');
  if (!container) {
    container = document.createElement('div');
    container.id = 'temp-notification-container';
    container.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    `;
    document.body.appendChild(container);
  }
  
  container.appendChild(notification);
  
  // Auto remove after 4 seconds
  setTimeout(() => {
    if (notification.parentNode) {
      notification.style.animation = 'slideOutRight 0.3s ease forwards';
      setTimeout(() => notification.remove(), 300);
    }
  }, 4000);
}

function getNotificationIcon(type) {
  const icons = {
    success: '‚úÖ',
    error: '‚ùå',
    warning: '‚ö†Ô∏è',
    info: '‚ÑπÔ∏è'
  };
  return icons[type] || 'üì¢';
}

// Form submission with loading state
document.addEventListener('submit', (e) => {
  const form = e.target;
  const submitBtn = form.querySelector('button[type="submit"]');
  
  if (submitBtn && !submitBtn.disabled) {
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    // Re-enable after 5 seconds to prevent permanent disability
    setTimeout(() => {
      submitBtn.classList.remove('loading');
      submitBtn.disabled = false;
    }, 5000);
  }
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  // Escape to close modals
  if (e.key === 'Escape') {
    const openModal = document.querySelector('.modal[style*="flex"]');
    if (openModal) {
      if (openModal.id === 'delete-modal') {
        closeDeleteModal();
      } else if (openModal.id === 'photo-modal') {
        closePhotoModal();
      }
    }
  }
  
  // Ctrl/Cmd + F to focus search
  if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
    e.preventDefault();
    const searchInput = document.getElementById('memory-search');
    if (searchInput) {
      searchInput.focus();
      searchInput.select();
    }
  }
});

// Handle image loading errors
document.addEventListener('error', (e) => {
  if (e.target.tagName === 'IMG') {
    e.target.style.display = 'none';
    const container = e.target.closest('.memory-photo-container');
    if (container) {
      container.innerHTML = `
        <div style="padding: 40px; text-align: center; color: rgba(255,255,255,0.6);">
          <div style="font-size: 2rem; margin-bottom: 8px;">üñºÔ∏è</div>
          <div>Image not found</div>
        </div>
      `;
    }
  }
}, true);

// Optimize performance on scroll
let ticking = false;

function updateScrollElements() {
  // Add parallax or other scroll effects here if needed
  ticking = false;
}

document.addEventListener('scroll', () => {
  if (!ticking) {
    requestAnimationFrame(updateScrollElements);
    ticking = true;
  }
});

// Touch gesture support for mobile
let touchStartX = 0;
let touchStartY = 0;

document.addEventListener('touchstart', (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, { passive: true });

document.addEventListener('touchmove', (e) => {
  if (!touchStartX || !touchStartY) {
    return;
  }
  
  const touchEndX = e.touches[0].clientX;
  const touchEndY = e.touches[0].clientY;
  
  const diffX = touchStartX - touchEndX;
  const diffY = touchStartY - touchEndY;
  
  // Detect swipe gestures (if needed for future features)
  if (Math.abs(diffX) > Math.abs(diffY)) {
    if (diffX > 50) {
      // Swipe left
    } else if (diffX < -50) {
      // Swipe right
    }
  }
  
  touchStartX = 0;
  touchStartY = 0;
}, { passive: true });

// Initialize on page load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeMemoriesPage);
} else {
  initializeMemoriesPage();
}

// Add extra styles for temporary notification system
const notificationStyles = `
.notification {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  animation: slideInRight 0.3s ease;
  max-width: 300px;
  border-left: 4px solid var(--accent);
  color: #374151;
}

.notification-success { border-left-color: #10b981; }
.notification-error { border-left-color: #ef4444; }
.notification-warning { border-left-color: #f59e0b; }
.notification-info { border-left-color: #3b82f6; }

.notification-icon {
  font-size: 16px;
  flex-shrink: 0;
}

.notification-message {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
}

.notification-close {
  background: none;
  border: none;
  color: #6b7280;
  cursor: pointer;
  font-size: 18px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.notification-close:hover {
  background: rgba(0,0,0,0.1);
  color: #374151;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideOutRight {
  to {
    opacity: 0;
    transform: translateX(100%);
  }
}

.edit-container {
  margin: 16px 0;
  padding: 16px;
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.1);
}

.edit-textarea {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 2px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.1);
  color: white;
  font-size: 0.95rem;
  font-family: inherit;
  resize: vertical;
  margin-bottom: 12px;
}

.edit-textarea:focus {
  outline: none;
  border-color: var(--accent);
  background: rgba(255,255,255,0.15);
}

.edit-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

@media (max-width: 480px) {
  .edit-actions {
    flex-direction: column;
  }
  
  .edit-actions .btn {
    width: 100%;
  }
}
`;

// Inject styles if not already present
if (!document.getElementById('memories-extra-styles')) {
  const styleSheet = document.createElement('style');
  styleSheet.id = 'memories-extra-styles';
  styleSheet.textContent = notificationStyles;
  document.head.appendChild(styleSheet);
}
</script>
{% endblock %}
{% endblock %}